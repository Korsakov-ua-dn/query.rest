## Выбираемые данные

Опциональным параметром __`data`__ указываются свойства объекта, которые нужно получить. Если 
параметр не указан, то возвращается только идентификатор объекта.

```
GET /some/5c2f3ed1fee590496c93779d
```
```json
{
  "_id": "5c2f3ed1fee590496c93779d",
  "_type": "some"
}
```

#### Все свойства

Для указания выборки всех свойств объекта используется символ `*` - выбрать все свойства. 
Возвращются непосредственные свойства объекта (документа базы данных) с учётом их доступности. 

```
GET /some/5c2f3ed1fee590496c93779d?fields=*
```
```json
{
  "_id": "5c2f3ed1fee590496c93779d",
  "_type": "some",
  "name": "Test object",
  "code": "001",
  "profile": {
    "phone":"+79996665544",
    "avatar":{
      "_id": "5c2f3ed1fee590496c63759f",
      "_type": "file"
    }
  }
}
```

#### Требуемые свойства

Чтобы выбрать конкретные свойства объекта, нужно указать их через запятую. Для вложенности
использются круглые скобки. Идентфикатор объекта возвращается всегда.

```
GET /some/5c2f3ed1fee590496c93779d?fields=name,profile{phone}
```
```json
{
  "_id": "5c2f3ed1fee590496c93779d",
  "name": "Test object",
  "profile": {
    "phone":"+79996665544"
  }
}
```

#### Выборка свойства отношений


Используя тот же синтаксис можно запросить свойства связанных объектов. Таким образом одним запросом
получить все необходимые данные, связанные между собой.

```
GET /some/5c2f3ed1fee590496c93779d?fields=profile(avatar(url,extension))
```
```json
{
  "_id": "5c2f3ed1fee590496c93779d",
  "profile": {
    "avatar":{
      "_id": "5c2f3ed1fee590496c63759f",
      "url": "/uploads/1928-212/5c2f3ed1fee590496c63759f.png",
      "extension": "png"
    }
  }
}
```

#### Выборка списка

Если апи возвращает список объектов, то параметр fields применяется к каждому объекту списка. 
При этом результат запроса будет не полностью соответствовать параметру fields, так как вместо
объекта вернется вложенная структура с items.

```
GET /some?fields=name,profile(phone)
```

```json
{
  "items": [
    {
      "_id": "5c2f3ed1fee590496c93779d",
      "name": "Test object",
      "profile": {
        "phone":"+79996665544"
      }
    },
    {
      "_id": "5c2f3ed1fee590496c93779m",
      "name": "Test object 2",
      "profile": {
        "phone":"+79996665555"
      }
    }
  ]
}
```

Для консистености запроса и результата необходимо параметры в fields обернуть в items. 

```
GET /some?fields=items(name,profile(phone))
```

У самого списка могут быть свои свойства. Например общее количество записей для построения пагинации. 
Тогда их указываем через запятую после items
 
```
GET /some?fields=items(name,profile(phone)),count
```
```json
{
  "items": [
    {
      "_id": "5c2f3ed1fee590496c93779d",
      "name": "Test object",
      "profile": {
        "phone":"+79996665544"
      }
    },
    {
      "_id": "5c2f3ed1fee590496c93779m",
      "name": "Test object 2",
      "profile": {
        "phone":"+79996665555"
      }
    }
  ],
  "count": 105
}
```

Какие именно свойства есть у списка зависит от реализации АПИ, по умолчанию достпен `count`. 
Можно реализовать выборку средних, минимальных значений, но эти функции лучше реализовывать отдельным
запросом.

#### Исключение свойства

Если у объекта много свойств и только одно из них не требуется возвращать, то вместо перечисления
длинного списка возвращаемых свойств без указания исключения одного можно применить отрицание выборки.
Сачала указываем, что нужны все свойства символом `*`, далее через запятую свойства, которое исключить
с символом `!`. Если не указать *, то никакие свойства не вернуться.

```
GET /some?fields=*,!name
```

#### Отношения разного типа

Одноименное свойство множества объектов может ссылаться на разного типа объекта. Например объект "избранного"
может ссылаться на пользователя, статью, товар и прочие типы объектов. Используя fields при выборке 
отношений по умочланию указанные свойства будут выбираться без различия на тип связанного объекта.
Например указав `surname` и `price` для свойств пользоветя `price` окажется равным `null`, а для 
товаров `surname` будет `null`. С одной стороны получаем консиситную выборку. Если у объекта свойства
нет, то оно null, но само свойство будет присутвовать в выборке.

Чтобы fields применялся только к объектам опредленного типа, необходимо использовать типизацию.
Перед именем свойства указываем название типа, разделяя через `:`

```
GET /favorites?fields=relative(user:surname,product:price,product:title)
```  
```json
{
  "items": [
    {
      "_id": "5c2f3ed1fee590496c93779d",
      "relative": {
        "_id": "5c2f3ed1fee590496c935678",
        "_type": "user",
        "surname": "UserSurname"
      }
    },
    {
      "_id": "5c2f3ed1fee590496c93778f",
      "relative": {
        "_id": "5c2f3ed1fee590496c935608",
        "_type": "product",
        "price": 100,
        "title": "ProductTitle"
      }
    }
  ]
}
```

Тип можно указывать для любых свойств, не только свойств отношений. Например, выбирая пользователей
они могут отличаться типом за счёт наследования типов. Таким образом в одном списке будут админы,
менеджеры и другие пользователи, отличающиеся свойствами. 

#### Дерево (рекурсии)

Символом `^` указывается ссылка на перечень полей уровнем выше скобки. Используется для выборки
рекурсивных отношений (иерархий). 

Например у каждого комментрия есть свойство children с вложенными комментриями, у которых тоже есть
вложенные комментрии. Запрос без `^` выглядел бы так:

```
GET /news?fields=title,text,comments(title,text,children(title,text,children(title,text,children(title,text,children))
```

И то здесь описана выборка на три уровня вложеннности, а что если вложенность больше? Тогда применяем
ссылку на шаблон полей. Ссылка относитльная

```
GET /news?fields=title,text,comments(title,text,children(^))
```

Чтбы сделать ссылку на два и более уровней выше, то нужно указать соответсвующей количество 
символов или к символу подставить число `^^` `^2`

```
GET /product?fields=title,text,brend(title,products(^^))
```
